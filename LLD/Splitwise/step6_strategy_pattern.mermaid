%% ========================================
%% STEP 6: STRATEGY PATTERN FOR SPLIT TYPES
%% ========================================
%% WHAT WE ADDED: Strategy pattern for different split calculations
%% WHY: Different algorithms for EQUAL, EXACT, PERCENTAGE splits
%% ========================================

classDiagram
    %% ========== EXPENSE SERVICE (from Step 4) ==========
    class ExpenseService {
        <<Service>>
        -ExpenseRepository expenseRepository
        -SplitStrategy splitStrategy
        +addExpense(ExpenseDTO) Expense
        +setSplitStrategy(SplitStrategy) void
    }

    %% ========== STRATEGY INTERFACE ==========
    class SplitStrategy {
        <<Interface>>
        +calculateSplit(amount, participants, details) Map~String, BigDecimal~
        +validate(amount, details) boolean
    }

    %% ========== CONCRETE STRATEGIES ==========

    class EqualSplitStrategy {
        <<Strategy>>
        +calculateSplit(amount, participants, details) Map
        +validate(amount, details) boolean
    }

    class ExactSplitStrategy {
        <<Strategy>>
        +calculateSplit(amount, participants, details) Map
        +validate(amount, details) boolean
    }

    class PercentageSplitStrategy {
        <<Strategy>>
        +calculateSplit(amount, participants, details) Map
        +validate(amount, details) boolean
    }

    class SharesSplitStrategy {
        <<Strategy>>
        +calculateSplit(amount, participants, details) Map
        +validate(amount, details) boolean
    }

    %% ========== FACTORY ==========
    class SplitStrategyFactory {
        <<Factory>>
        -Map~SplitType, SplitStrategy~ strategies
        +getStrategy(SplitType) SplitStrategy
        +registerStrategy(SplitType, SplitStrategy) void
    }

    %% ========== CONTEXT ==========
    class SplitContext {
        <<Context>>
        -SplitStrategy strategy
        +setStrategy(SplitStrategy) void
        +executeSplit(amount, participants, details) Map
    }

    %% ========== ENUM ==========
    class SplitType {
        <<Enumeration>>
        EQUAL
        EXACT
        PERCENTAGE
        SHARES
    }

    %% ========== RELATIONSHIPS ==========

    %% ExpenseService uses Context
    ExpenseService --> SplitContext : uses

    %% Context uses Strategy
    SplitContext --> SplitStrategy : uses

    %% Strategy interface implemented by concrete strategies
    SplitStrategy <|.. EqualSplitStrategy : implements
    SplitStrategy <|.. ExactSplitStrategy : implements
    SplitStrategy <|.. PercentageSplitStrategy : implements
    SplitStrategy <|.. SharesSplitStrategy : implements

    %% Factory creates strategies
    SplitStrategyFactory --> SplitStrategy : creates
    SplitStrategyFactory --> SplitType : maps from

    %% ExpenseService uses Factory
    ExpenseService --> SplitStrategyFactory : uses

    %% ========== NOTES ==========

    note for SplitStrategy "ğŸ¨ STRATEGY PATTERN\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nDefines family of algorithms\nMakes them interchangeable\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nWHY USE?\nâœ… Add new split types easily\nâœ… No if-else chains\nâœ… Open/Closed Principle\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nEach strategy = one algorithm"

    note for EqualSplitStrategy "â— EQUAL SPLIT\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nAlgorithm:\namount Ã· n participants\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nExample:\nâ‚¹3000 Ã· 3 = â‚¹1000 each\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nEdge case:\nâ‚¹100 Ã· 3 = â‚¹33.33 each\nLast person gets â‚¹33.34\n(handles rounding)"

    note for ExactSplitStrategy "ğŸ’µ EXACT SPLIT\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nAlgorithm:\nUse provided amounts\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nExample:\nAlice: â‚¹1200\nBob: â‚¹1800\nTotal: â‚¹3000 âœ“\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nValidation:\nSum must equal amount!"

    note for PercentageSplitStrategy "ğŸ“Š PERCENTAGE SPLIT\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nAlgorithm:\namount Ã— (percentage Ã· 100)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nExample:\nAlice: 40% of â‚¹3000 = â‚¹1200\nBob: 60% of â‚¹3000 = â‚¹1800\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nValidation:\nPercentages must sum to 100!"

    note for SharesSplitStrategy "ğŸ¯ SHARES SPLIT\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nAlgorithm:\namount Ã— (shares Ã· total_shares)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nExample:\nAlice: 2 shares\nBob: 3 shares\nTotal: 5 shares\n\nAlice: â‚¹3000 Ã— (2Ã·5) = â‚¹1200\nBob: â‚¹3000 Ã— (3Ã·5) = â‚¹1800\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nFuture enhancement!"

    note for SplitStrategyFactory "ğŸ­ FACTORY PATTERN\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nCreates right strategy\nbased on SplitType\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nMap:\nEQUAL â†’ EqualSplitStrategy\nEXACT â†’ ExactSplitStrategy\nPERCENTAGE â†’ PercentageSplitStrategy\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâœ… Centralized creation\nâœ… Easy to extend"

    note for SplitContext "ğŸ¯ CONTEXT CLASS\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nHolds strategy reference\nDelegates to strategy\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nUsage:\ncontext.setStrategy(equalStrategy)\nMap<String, BigDecimal> splits =\n  context.executeSplit(...)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nâœ… Decouples client from strategies"

%% ========================================
%% DESIGN PATTERN: STRATEGY
%% 1. Define interface (SplitStrategy)
%% 2. Implement concrete strategies
%% 3. Context uses strategy
%% 4. Factory creates strategies
%% ========================================
